%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CleanCV.sty - Modern and minimal LaTeX style for academic CV
% 
% Designed for academic researchers and students with focus on readability and clean typography
% 
% Version: 1.0
% Date: 2025/04/10
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{CleanCV}[2025/04/10 Clean Academic CV Style]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PACKAGE DEPENDENCIES
% Only essential packages are included for maintainability
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[T1]{fontenc}                % Font encoding
\RequirePackage{fontawesome}                % Icons for contact info
\RequirePackage[oldstyle,proportional]{ETbb}% ET Book font for elegant typography
\RequirePackage{geometry}                   % Page layout customization
\RequirePackage{sectsty}                    % Section formatting
\RequirePackage{hyperref}                   % Hyperlinks functionality
\RequirePackage[dvipsnames]{xcolor}         % Color support
\RequirePackage{enumitem}                   % List customization
\RequirePackage{titlesec}                   % Section title formatting
\RequirePackage{fancyhdr}                   % Header/footer customization
\RequirePackage{etoolbox}                   % Conditional commands support

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PAGE LAYOUT CONFIGURATION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Set margins for optimal readability and content space
\geometry{
  letterpaper,          % Use letter paper size
  left=2.5cm,           % Left margin
  right=2.5cm,          % Right margin
  top=2cm,              % Top margin
  bottom=2.5cm          % Bottom margin
}

% Clean typography settings
\setlength{\parindent}{0pt}     % Remove paragraph indentation
\setlength{\parskip}{0.2em}     % Set spacing between paragraphs
\titlespacing*{\section}{0pt}{1.5em}{0.5em}  % Section spacing

% Page numbering and last updated date in footer
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[L]{\footnotesize Page \thepage}
\fancyfoot[R]{\footnotesize Last updated: \today}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TYPOGRAPHY AND STYLING
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Section styling with small caps for elegant headers
\titleformat{\section}{\Large\normalfont\scshape\bfseries}{\thesection}{1em}{}
\allsectionsfont{\mdseries\scshape\Large}

% Prevent typographical widows and orphans
\clubpenalty=10000
\widowpenalty=10000
\displaywidowpenalty=10000

% Primary theme color - customize by changing RGB values
\definecolor{primary}{RGB}{83, 39, 115}  % Default: Royal purple

% Hyperlink setup with primary color
\hypersetup{
  colorlinks=true,        % Colored links instead of boxes
  urlcolor=primary,       % URL color
  linkcolor=primary,      % Internal link color
  citecolor=primary,      % Citation color
  pdftitle={Curriculum Vitae},
  pdfauthor={},
  pdfcreator={},
  pdfproducer={}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% HEADER COMMANDS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Command for name at top of CV
\newcommand{\cvname}[1]{
  \begin{center}
    {\Huge \textsc{#1}}
  \end{center}
}

% Contact bar with social media and contact info
% Arguments:
%   #1: Personal website
%   #2: Email
%   #3: GitHub username
%   #4: LinkedIn username
%   #5: Google Scholar URL
%   #6: Location
\newcommand{\contactbar}[6]{
  \begin{center}
    \small
    \faHome\space{\href{https://#1}{#1}} \enspace
    \faEnvelope\space{\href{mailto:#2}{#2}} \enspace
    \faGithub\space{\href{https://github.com/#3}{#3}} \enspace
    \faLinkedin\space{\href{https://linkedin.com/in/#4}{#4}} \enspace
    \faGraduationCap\space{\href{#5}{Google Scholar}} \enspace
    \faMapMarker\space{#6} \enspace
  \end{center}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CV/RESUME MODE SWITCH
% Controls which sections are displayed
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\ifcv
\cvtrue  % Default to CV mode (includes all sections)
         % Use \cvfalse to default to resume mode (fewer sections)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CONTENT FORMATTING COMMANDS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Primary entry for positions with optional bullet points
% Arguments:
%   #1: [Optional] Bullet points (\item statements)
%   #2: Organization
%   #3: Location
%   #4: Title
%   #5: Date
\newcommand{\cventry}[5][]{
  \textbf{#2} \hfill #3 \\ #4 \hfill #5 \par
  \ifx&#1&\else\begin{itemize}#1\end{itemize}\fi
}

% Simple entry for items without bullet points
% Arguments:
%   #1: Organization
%   #2: Title
%   #3: Date
\newcommand{\cvitem}[3]{
  #1, #2 \hfill #3
}

% Configure itemize environment for compact, clean lists
\setlist[itemize]{nosep, left=0pt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BIBLIOGRAPHY MANAGEMENT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[style=numeric, sorting=ydnt, backend=biber]{biblatex}

% Makes the author's name bold in the publication list
% Usage: \boldname{LastName}{FirstName}{FirstInitial}
\newcommand*{\boldname}[3]{%
  \def\lastname{#1}%
  \def\firstname{#2}%
  \def\firstinit{#3}}
\boldname{}{}{}

% Implementation of name bolding in bibliography
% See https://tex.stackexchange.com/a/327046
\renewcommand{\mkbibnamegiven}[1]{%
  \ifboolexpr{ ( test {\ifdefequal{\firstname}{\namepartgiven}} or test {\ifdefequal{\firstinit}{\namepartgiven}} ) and test {\ifdefequal{\lastname}{\namepartfamily}} }
  {\mkbibbold{#1}}{#1}%
}
\renewcommand{\mkbibnamefamily}[1]{%
  \ifboolexpr{ ( test {\ifdefequal{\firstname}{\namepartgiven}} or test {\ifdefequal{\firstinit}{\namepartgiven}} ) and test {\ifdefequal{\lastname}{\namepartfamily}} }
  {\mkbibbold{#1}}{#1}%
}

% Adds asterisk for joint first authors
% Use the 'jointfirst' annotation in your .bib file
% See https://tex.stackexchange.com/a/699794
\renewcommand*{\mkbibcompletename}[1]{%
  \ifitemannotation{jointfirst}
    {#1^*}       % Name* (if joint first author)
    {#1}         % Name (otherwise)
}